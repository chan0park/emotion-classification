# Directory 
```
Project
│   requirements.txt
│   README.md
│   test.txt    
│
└───data
│   └───emo-mapping
│       │   go-ekman.json
│       │   hurricane-ekman.json
│       │   ...
│   └───processed_emotions
│       │   go-ekman.pkl
│       │   hurricane-ekman.pkl
│       │   blm-ekman.pkl
│       │   ...
└───saved_models
│   └───hur2go
│       │   anger.pt
│       │   disgust.pt
│       │   fear.pt
│       │   joy.pt
│       │   sadness.pt
│       │   surprise.pt
└───scripts
│   │   train.sh
│   │   train_differnt_seeds.sh
│   │   generate_labels.sh
└───src
    │   args.py
    │   model.py
    │   train.py
    │   generate.py
    │   ...
```

## requirements
run `conda create --name <env> --file requirements.txt`

## Data
under `data/` you can find the processed emotion datasets (GoEmotions, HurricaneEmo, and BLM).
When we say *processed*, it means we split the data into "train","dev","test" sets and also mapped annotation into a one-hot vector.

For example, `data/processed_emotions/go-ekman.pkl` is a dictionary with three keys: "train","dev","test". And `go-ekman["train"]` is a list of training samples in the following format: [(SAMPLE_TEXT, [0,1,0,0,0,0]), ...]. As the vector is mapped to ["disgust", "fear", "anger", "sadness", "surprise", "joy"] respectively, the first sample shows that it has a positive label for "fear", but nothing else. 

You can format your own training data in to this same format and name it as "{NAME}-ekman.pkl", and place it under `data/processed_emotions/`, and then edit the function `import_data` in `src/functions.py`.

## saved_models
Assuming the format of the target text is more similar to the plain sentences, rather than tweets, we used HurricaneEmo as source data (for pretraining), and used GoEmotions as target data (for the second training phase). Also in the original paper, we used bert parameters that are further pre-trianed with taraget domain text (i.e. tweets). However, based on the same assumption mentioned earlier, we used the "base-bert" model from transformers model as is.

We put the resulting trained model for each emotion under `saved_models/hur2go`. Please note that we have one separate model for each emotion rather than having one multi-classification model trained. 

## src
Source codes are located here. You may want to change `src/config.py` to change the project path, transformer cache path, and others.
The most important two files are `src/train.py` and `src/generate.py`. For train.py, arguments are defined in a separate file (`src/args.py`).

## scripts
We provide scripts for model training and label generating in `scripts/`. You can see which arguments you need to set in order to run the codes.

## Example
We also provide a test case and the resulting model output. test cases are in `test.txt` file and the resulting label files are located under `res/test.*`. 
The result files are generated by running `scripts/generate_labels.sh`. 

# Usage

## How to train a model?

please refer to scripts/train.sh

## How to generate emotion labels?

please refer to scripts/generate_labels.sh. You can create a similar text file, and just change the file path in the script.

## what if I want to add another training data?

please refer to the explanation above, and also take a look at the processed emotion pkl files yourself. It should be fairly straightforward. 